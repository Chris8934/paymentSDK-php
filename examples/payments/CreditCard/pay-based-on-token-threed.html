<!DOCTYPE html><html lang="en"><head><title>examples\payments\CreditCard\pay-based-on-token-threed</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="examples\payments\CreditCard\pay-based-on-token-threed"><meta name="groc-project-path" content="examples\payments\CreditCard\pay-based-on-token-threed.php"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">examples\payments\CreditCard\pay-based-on-token-threed.php</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-comment">/**
 * Shop System SDK:
 * - Terms of Use can be found under:
 * https://github.com/wirecard/paymentSDK-php/blob/master/_TERMS_OF_USE
 * - License can be found under:
 * https://github.com/wirecard/paymentSDK-php/blob/master/LICENSE
 */</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h1 id="purchase-for-credit-card-via-token">Purchase for credit card via token</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Enter token-id from successful authorization/purchase for recur payment with credit card using default maid.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="required-objects">Required objects</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To include the necessary files, we use the composer for PSR-4 autoloading.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../../vendor/autoload.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../inc/common.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../configuration/config.php'</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../inc/header.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Amount</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">FailureResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">FormInteractionResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">SuccessResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Transaction</span>\<span class="hljs-title">CreditCardTransaction</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">TransactionService</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction-related-objects">Transaction related objects</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create a amount object as amount which has to be paid by the consumer.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$amount</span> = <span class="hljs-keyword">new</span> Amount(<span class="hljs-number">12.59</span>, <span class="hljs-string">'EUR'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Token ID ist necessary for recur purchase with credit card via token.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$tokenId</span> = array_key_exists(<span class="hljs-string">'tokenId'</span>, <span class="hljs-variable">$_POST</span>) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'tokenId'</span>] : <span class="hljs-keyword">null</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To make this example usable, even no token ID is provided, a predefined existing token ID is set.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$tokenId</span> === <span class="hljs-keyword">null</span>) {
    <span class="hljs-variable">$tokenId</span> = <span class="hljs-string">'4304509873471003'</span>;
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The redirect URL determines where the consumer should be redirected to
after an approval/cancellation on the issuer&#39;s ACS page.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$redirectUrl</span> = getUrl(<span class="hljs-string">'return.php?status=success'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction">Transaction</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The credit card transaction contains all relevant data for the payment process.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span> = <span class="hljs-keyword">new</span> CreditCardTransaction();
<span class="hljs-variable">$transaction</span>-&gt;setAmount(<span class="hljs-variable">$amount</span>);
<span class="hljs-variable">$transaction</span>-&gt;setTokenId(<span class="hljs-variable">$tokenId</span>);
<span class="hljs-variable">$transaction</span>-&gt;setTermUrl(<span class="hljs-variable">$redirectUrl</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h4 id="account-holder-with-address">Account holder with address</h4></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-variable">$address</span> = <span class="hljs-keyword">new</span> \Wirecard\PaymentSdk\Entity\Address(<span class="hljs-string">'DE'</span>, <span class="hljs-string">'Berlin'</span>, <span class="hljs-string">'Teststrasse'</span>);
<span class="hljs-variable">$address</span>-&gt;setStreet2(<span class="hljs-string">'Test street 2'</span>);
<span class="hljs-variable">$address</span>-&gt;setStreet3(<span class="hljs-string">'Test street 3'</span>);
<span class="hljs-variable">$address</span>-&gt;setPostalCode(<span class="hljs-string">'13353'</span>);

<span class="hljs-variable">$accountHolder</span> = <span class="hljs-keyword">new</span> \Wirecard\PaymentSdk\Entity\AccountHolder();
<span class="hljs-variable">$accountHolder</span>-&gt;setEmail(<span class="hljs-string">'john.doe@test.com'</span>);
<span class="hljs-variable">$accountHolder</span>-&gt;setPhone(<span class="hljs-string">'03018425165'</span>);
<span class="hljs-variable">$accountHolder</span>-&gt;setWorkPhone(<span class="hljs-string">'0765573242'</span>);
<span class="hljs-variable">$accountHolder</span>-&gt;setMobilePhone(<span class="hljs-string">'041232342'</span>);
<span class="hljs-variable">$accountHolder</span>-&gt;setDateOfBirth(<span class="hljs-keyword">new</span> \DateTime(<span class="hljs-string">'1973-12-07'</span>));
<span class="hljs-variable">$accountHolder</span>-&gt;setAddress(<span class="hljs-variable">$address</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>3DS parameters</p>
<h3 id="contains-information-for-the-3ds-requestor">Contains information for the 3DS Requestor</h3>
<p>Information about how the 3DS Requestor authenticated the cardholder before or during the transaction
Possible values 01 guest login, 02 User Account in Shop, 03 federated id, 04 issuer of card credentials, 05 third-party authentication, 06 FIDO authentication</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span> = <span class="hljs-keyword">new</span> \Wirecard\PaymentSdk\Entity\AccountInfo();
<span class="hljs-variable">$authenticationInfo</span>-&gt;setAuthMethod(\Wirecard\PaymentSdk\Constant\AuthMethod::GUEST_CHECKOUT);
<span class="hljs-variable">$authenticationInfo</span>-&gt;setAuthTimestamp();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Indicates if a challenge is requested for this transaction, 01 no preference, 02 no challenge, 03 challenge requested 3DS, 04 challenge requested Mandate</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setChallengeInd(\Wirecard\PaymentSdk\Constant\ChallengeInd::NO_PREFERENCE);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="contains-additional-information-about-the-cardholder39s-account-provided-by-the-3ds-requestor">Contains additional information about the Cardholder&#39;s account provided by the 3DS Requestor</h3>
<p>Account creation date</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setCreationDate(<span class="hljs-keyword">new</span> DateTime());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Account update date</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setUpdateDate(<span class="hljs-keyword">new</span> DateTime());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Account password change date</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setPassChangeDate(<span class="hljs-keyword">new</span> DateTime());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Account first usage of the address</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setShippingAddressFirstUse(<span class="hljs-keyword">new</span> DateTime());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Card creation date</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setCardCreationDate(<span class="hljs-keyword">new</span> DateTime());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Number of transactions (successful and abandoned) for this cardholder account across all payment accounts in the previous 24 hours</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setAmountTransactionsLastDay(<span class="hljs-number">2</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Number of transactions (successful and abandoned) for this cardholder account across all payment accounts in the previous year</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setAmountTransactionsLastYear(<span class="hljs-number">500</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Number of card attempts in the previous 24 hours</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setAmountCardTransactionsLastDay(<span class="hljs-number">1</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Number of purchases with this cardholder account during the previous six months</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$authenticationInfo</span>-&gt;setAmountPurchasesLastSixMonths(<span class="hljs-number">30</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set accountInfo for AccountHolder</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$accountHolder</span>-&gt;setAccountInfo(<span class="hljs-variable">$authenticationInfo</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Additional information about the account provided by the 3DS requestor. Limited to 64 characters</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$accountHolder</span>-&gt;setCrmId(<span class="hljs-string">'12daw2r'</span>);
<span class="hljs-variable">$transaction</span>-&gt;setAccountHolder(<span class="hljs-variable">$accountHolder</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="merchant39s-assessment-of-the-level-of-fraud-risk-for-the-specific-authentication-for-both-the-cardholder-and-the-authentication-being-conducted">Merchant&#39;s assessment of the level of fraud risk for the specific authentication for both the cardholder and the authentication being conducted</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-variable">$merchantRiskIndicator</span> = <span class="hljs-keyword">new</span> \Wirecard\PaymentSdk\Entity\RiskInfo();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Indicates whether cardholder is placing an order for merchandise with a future availability or release date. Merchandise available &#39;01&#39;, Future availability &#39;02&#39;</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$merchantRiskIndicator</span>-&gt;setAvailability(\Wirecard\PaymentSdk\Constant\RiskInfoAvailability::MERCHANDISE_AVAILABLE);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>For electronic delivery, the email address the merchandise was delivered</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$merchantRiskIndicator</span>-&gt;setDeliveryEmailAddress(<span class="hljs-string">'max.muster@mail.com'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Indicates the merchandise delivery timeframe. Electronic Delivery 01, Same day shipping 02, Overnight shipping 03, Two-day or more shipping 04</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$merchantRiskIndicator</span>-&gt;setDeliveryTimeFrame(\Wirecard\PaymentSdk\Constant\RiskInfoDeliveryTimeFrame::ELECTRONIC_DELIVERY);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Expected delivery date for pre-ordered goods</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$merchantRiskIndicator</span>-&gt;setPreOrderDate(<span class="hljs-keyword">new</span> DateTime());</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Was the good already bought before. First time ordered 01, Reordered 02</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$merchantRiskIndicator</span>-&gt;setReorderItems(\Wirecard\PaymentSdk\Constant\RiskInfoReorder::FIRST_TIME_ORDERED);
<span class="hljs-variable">$transaction</span>-&gt;setRiskInfo(<span class="hljs-variable">$merchantRiskIndicator</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Transaction type, classification of goods derived from ISO 8583. Goods/Service purchase 01, Check Acceptance 03, Account Funding 10, Quasi-Cash Transaction 11, Prepaid activation and Loan 28</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span>-&gt;setIsoTransactionType(\Wirecard\PaymentSdk\Constant\IsoTransactionType::CHECK_ACCEPTANCE);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="contains-browser-information-this-field-is-required-when-devicechannel-is-set-to-02">Contains browser information. This field is required when deviceChannel is set to 02.</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-variable">$browser</span> = <span class="hljs-keyword">new</span> \Wirecard\PaymentSdk\Entity\Browser();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Defines the challenge window size through the given width in px</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$browser</span>-&gt;setChallengeWindowSize(<span class="hljs-number">500</span>);
<span class="hljs-variable">$transaction</span>-&gt;setBrowser(<span class="hljs-variable">$browser</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction-service">Transaction Service</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The service is used to execute the payment operation itself.
A response object is returned.
For this example the default maid gets used for recur payment. For integration the configuration must be set to
the corresponding maid. (3D-maid or Non-3D-maid)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transactionService</span> = <span class="hljs-keyword">new</span> TransactionService(<span class="hljs-variable">$config</span>);
<span class="hljs-variable">$response</span> = <span class="hljs-variable">$transactionService</span>-&gt;pay(<span class="hljs-variable">$transaction</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="response-handling">Response handling</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The response from the service can be used for disambiguation.
In case of a successful transaction, a <code>SuccessResponse</code> object is returned.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> SuccessResponse):
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'Payment successfully completed.&lt;br&gt;'</span>;
    <span class="hljs-keyword">echo</span> getTransactionLink(<span class="hljs-variable">$baseUrl</span>, <span class="hljs-variable">$response</span>);
    <span class="hljs-preprocessor">?&gt;</span>
    &lt;br&gt;
    &lt;form action=<span class="hljs-string">"cancel.php"</span> method=<span class="hljs-string">"post"</span>&gt;
        &lt;input type=<span class="hljs-string">"hidden"</span> name=<span class="hljs-string">"parentTransactionId"</span> value=<span class="hljs-string">"&lt;?= $response-&gt;getTransactionId() ?&gt;"</span>/&gt;
        &lt;button type=<span class="hljs-string">"submit"</span> <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">btn</span> <span class="hljs-title">btn</span>-<span class="hljs-title">primary</span>"&gt;<span class="hljs-title">Cancel</span> <span class="hljs-title">the</span> <span class="hljs-title">payment</span>&lt;/<span class="hljs-title">button</span>&gt;
    &lt;/<span class="hljs-title">form</span>&gt;

    &lt;?<span class="hljs-title">php</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>In case of a failed transaction, a <code>FailureResponse</code> object is returned.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> FailureResponse):</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>In our example we iterate over all errors and display them in a raw state.
You should handle them based on the given severity as error, warning or information.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$response</span>-&gt;getStatusCollection() <span class="hljs-keyword">as</span> <span class="hljs-variable">$status</span>) {
        <span class="hljs-comment">/**
         * <span class="hljs-doctag">@var</span> $status \Wirecard\PaymentSdk\Entity\Status
         */</span>
        <span class="hljs-variable">$severity</span> = ucfirst(<span class="hljs-variable">$status</span>-&gt;getSeverity());
        <span class="hljs-variable">$code</span> = <span class="hljs-variable">$status</span>-&gt;getCode();
        <span class="hljs-variable">$description</span> = <span class="hljs-variable">$status</span>-&gt;getDescription();
        <span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">'%s with code %s and message "%s" occurred.&lt;br&gt;'</span>, <span class="hljs-variable">$severity</span>, <span class="hljs-variable">$code</span>, <span class="hljs-variable">$description</span>);
    }
<span class="hljs-keyword">endif</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../inc/footer.php'</span>;</div></div></div></div></body></html>